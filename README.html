<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<title>README.html</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>

</head>

<body>

<h1 id="hunterdouglaspowerviewinterface">HunterDouglas PowerView Interface</h1>

<h2 id="universaldevicespg3">Universal Devices PG3</h2>

<p><a href="LICENSE"><img src="https://img.shields.io/github/license/mashape/apistatus.svg" alt="licence" id="shield" /></a></p>

<p>This plugin/nodeserver provides an interface between HunterDouglas Shades
and Polyglot V3 server supporting Universal Devices EISY or Polisy controllers</p>

<h3 id="getyouramazingeisyatuniversal-devicesudi">Get your amazing EISY at <a href="https://www.universal-devices.com/hunter-douglas/"><strong>Universal-Devices</strong></a></h3>

<h2 id="screenshotsscreenshots"><a href="/docs/screenshots.md">Screenshots</a></h2>

<h2 id="installation">Installation</h2>

<p>You can install This node server from the PG3 NodeServer Store.<br />
Read the <a href="POLYGLOT_CONFIG.md"><strong>Configuration</strong></a> file for instructions<br />
<a href="https://forum.universal-devices.com/forum/439-hunter-douglas/"><strong>The Forum</strong></a> is a great place to ask questions<br />
And <a href="/docs/troubleshooting.md"><strong>troubleshooting</strong></a> steps are also available,
and updated from forum discussions</p>

<h2 id="requirements">Requirements</h2>

<p><strong>IMPORTANT:</strong> There are differences for HunterDouglas G3 API versus G2 API</p>

<p>See the <a href="POLYGLOT_CONFIG.md"><strong>Configuration</strong></a> file for details</p>

<p>This node server will only run on Polyglot version 3. You will
need to have an EISY/Polisy with PG3 installed to run this node server</p>

<h3 id="seealsohunterdouglaspowerviewhd_powerviewforproductdetails">See also <a href="https://www.hunterdouglas.com/operating-systems/powerview-motorization">Hunter Douglas PowerView</a> for product details</h3>

<p>For PowerView G3 hubs, the API can be self hosted by your hub:</p>

<ul>
<li>Enable Swagger on your hub: <a href="http://powerview-g3.local/gateway/swagger?enable=true">swagger_enable</a></li>
<li>Get the Swagger results: <a href="http://powerview-g3.local:3002">swagger_results</a></li>
<li>Disable Swagger on your hub: <a href="http://powerview-g3.local/gateway/swagger?enable=false">swagger_disable</a></li>
</ul>

<p>For PowerView G2 hubs, checkout the <a href="/docs/PowerViewG2api.md"><strong>G2-API here</strong></a></p>

<h2 id="polling">Polling</h2>

<h3 id="longpoll">longPoll</h3>

<ul>
<li>currently every 60s but in G3 can be moved longer because of the events server</li>
</ul>

<h4 id="controllerlongpoll">controller longPoll</h4>

<ul>
<li>update all data from Gateway</li>
<li>set event array flagging each shade/scene to update</li>
<li>shades and scenes processed sequentially</li>
</ul>

<h4 id="shadelongpoll">shade longPoll</h4>

<ul>
<li>G3: logged, clear motion flag in case event motion-stopped missed</li>
<li>G2: logged</li>
</ul>

<h4 id="scenelongpoll">scene longPoll</h4>

<ul>
<li>G3: logged</li>
<li>G2: clear ST, Activated flag</li>
</ul>

<h3 id="shortpoll">shortPoll</h3>

<ul>
<li>currently every 5s</li>
</ul>

<h4 id="controllershortpoll">controller shortPoll</h4>

<ul>
<li>process general events, sse heartbeat check</li>
<li>if no events (60min curently) reset sse client</li>
</ul>

<h4 id="shadeshortpoll">shade shortPoll</h4>

<ul>
<li>process shade events</li>
</ul>

<h4 id="sceneshortpoll">scene shortPoll</h4>

<ul>
<li>process scene events</li>
</ul>

<h2 id="events:controller">Events: controller</h2>

<ul>
<li>G3 only generates events except home, which is generated by the plugin</li>
</ul>

<h3 id="homedoc-updated">homeDoc-updated</h3>

<ul>
<li>signals update of the G3 login to HunterDouglas</li>
<li>ACTION: just logged</li>
</ul>

<h3 id="home">home</h3>

<ul>
<li>plugin generated</li>
<li>sequentially update all shades, scenes once per longPoll</li>
<li>ACTION: each node checks once per shortPoll;updates then removes itself from array</li>
</ul>

<h2 id="events:scene">Events: scene</h2>

<h3 id="scene-activated">scene-activated</h3>

<ul>
<li>sent on completion of movement to scene positions from any source</li>
<li>ACTION:</li>
<li> G3 turn on ST, Activated</li>
<li> G2 turned on when plugin activates scene (does not get info from remote or app)</li>
</ul>

<h3 id="scene-deactivated">scene-deactivated</h3>

<ul>
<li>signal movement away from scene positions immediate from any source</li>
<li>ACTION:</li>
<li> G3 turn off ST, Activated</li>
<li> G2 is turned off on next longPoll when plugin activates scene</li>
<li> G2 (does not get info from remote or app</li>
</ul>

<h2 id="events:shade">Events: shade</h2>

<h3 id="shade-online">shade-online</h3>

<ul>
<li>kind of a heartbeat which keeps the sse client-server connection alive</li>
<li>ACTION: update position to currentPosition, logged as info</li>
<li>not sure how often this is pushed from the G3 side</li>
</ul>

<h3 id="shade-offline">shade-offline</h3>

<ul>
<li>assume this is generated by G3 if it cannot communicate with shade</li>
<li>ACTION: update position to currentPosition, logged as error</li>
</ul>

<h3 id="motion-started">motion-started</h3>

<ul>
<li>any shade motion from any source by any command</li>
<li>ACTION: set the ST, Motion flag, update position to targetPosition</li>
</ul>

<h3 id="motion-stopped">motion-stopped</h3>

<ul>
<li>shade motion from any source by any command</li>
<li>ACTION: clear the ST, Motion flag, update position to currentPosition</li>
</ul>

<h3 id="battery-alert">battery-alert</h3>

<ul>
<li>shade battery goes to &lt;= 2 or medium</li>
<li>ACTION: update battery status &amp; shade position, log error</li>
</ul>

</body>
</html>
